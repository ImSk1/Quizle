æ
PC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Contracts\IQuizDataService.cs
	namespace 	
Quizle
 
. 
Core 
. 
	Contracts 
{ 
public		 

	interface		 
IQuizDataService		 %
{

 
Task 
< 
QuizDto 
> 
GetDataAsync "
(" #
string# )
url* -
)- .
;. /
Task 
AddQuizRange 
( 
IEnumerable %
<% &
QuizDto& -
>- .
quizzes/ 6
)6 7
;7 8
Task 
< 
QuizDto 
> 
GetCurrentQuestion (
(( )
int) ,
?, -

difficulty. 8
)8 9
;9 :
Task 
< 
List 
< 
QuizDto 
> 
> "
GetAllCurrentQuestions 2
(2 3
)3 4
;4 5
} 
} ª
LC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Contracts\IUserService.cs
	namespace		 	
Quizle		
 
.		 
Core		 
.		 
	Contracts		 
{

 
public 

	interface 
IUserService !
{ 
Task )
UpdateAllUsersHasDoneQuestion *
(* +
bool+ /
valueToChangeTo0 ?
)? @
;@ A
Task )
UpdateAllUsersHasDoneQuestion *
(* +
bool+ /
valueToChangeTo0 ?
,? @

ExpressionA K
<K L
FuncL P
<P Q
ApplicationUserQ `
,` a
boolb f
>f g
>g h
usersToUpdatei v
)v w
;w x
} 
} ‡
FC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Models\AnswerDto.cs
	namespace 	
Quizle
 
. 
Core 
. 
Models 
{ 
public		 

class		 
	AnswerDto		 
{

 
public 
string 
Answer 
{ 
get "
;" #
set$ '
;' (
}) *
public 
bool 
	IsCorrect 
{ 
get  #
;# $
set% (
;( )
}* +
} 
} „
DC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Models\QuizDto.cs
	namespace 	
Quizle
 
. 
Core 
. 
Models 
{ 
public		 

class		 
QuizDto		 
{

 
public 
string 
Question 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Category 
{  
get! $
;$ %
set& )
;) *
}+ ,
public 
string 
Type 
{ 
get  
;  !
set" %
;% &
}' (
public 
string 

Difficulty  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
List 
< 
	AnswerDto 
> 
Answers &
{' (
get) ,
;, -
set. 1
;1 2
}3 4
} 
} °
NC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Models\QuizResponseModel.cs
	namespace 	
Quizle
 
. 
Core 
. 
Models 
{ 
internal 
class 
QuizResponseModel $
{		 
[

 	
JsonProperty

	 
(

 
$str

 %
)

% &
]

& '
public 
int 
ResponseCode 
{  !
get" %
;% &
set' *
;* +
}, -
[ 	
JsonProperty	 
( 
$str 
)  
]  !
public 
List 
< 
Result 
> 
Results #
{$ %
get& )
;) *
set+ .
;. /
}0 1
public 
class 
Result 
{ 	
[ 
JsonProperty 
( 
$str $
)$ %
]% &
public 
string 
Category "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 
JsonProperty 
( 
$str  
)  !
]! "
public 
string 
Type 
{  
get! $
;$ %
set& )
;) *
}+ ,
[ 
JsonProperty 
( 
$str &
)& '
]' (
public 
string 

Difficulty $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 
JsonProperty 
( 
$str $
)$ %
]% &
public 
string 
Question "
{# $
get% (
;( )
set* -
;- .
}/ 0
[ 
JsonProperty 
( 
$str *
)* +
]+ ,
public 
string 
CorrectAnswer '
{( )
get* -
;- .
set/ 2
;2 3
}4 5
[   
JsonProperty   
(   
$str   -
)  - .
]  . /
public!! 
List!! 
<!! 
string!! 
>!! 
IncorrectAnswers!!  0
{!!1 2
get!!3 6
;!!6 7
set!!8 ;
;!!; <
}!!= >
}"" 	
}## 
}$$ °
HC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\QuartzJobs\QuizJob.cs
	namespace 	
Quizle
 
. 
Core 
. 

QuartzJobs  
{		 
public

 

class

 
QuizJob

 
:

 
IJob

 
{ 
private 
readonly 
IQuizDataService )
_triviaDataService* <
;< =
private 
readonly 
IUserService %
_userService& 2
;2 3
private 
readonly 
IConfiguration '
_config( /
;/ 0
public 
QuizJob 
( 
IQuizDataService '
triviaDataService( 9
,9 :
IConfiguration; I
configurationJ W
,W X
IUserServiceY e
userServicef q
)q r
{ 	
_triviaDataService 
=  
triviaDataService! 2
;2 3
_config 
= 
configuration #
;# $
_userService 
= 
userService &
;& '
} 	
public 
async 
Task 
Execute !
(! " 
IJobExecutionContext" 6
context7 >
)> ?
{ 	
var 
quizEasy 
= 
await  
_triviaDataService! 3
.3 4
GetDataAsync4 @
(@ A
_configA H
.H I
GetValueI Q
<Q R
stringR X
>X Y
(Y Z
$strZ i
)i j
)j k
;k l
var 

quizMedium 
= 
await "
_triviaDataService# 5
.5 6
GetDataAsync6 B
(B C
_configC J
.J K
GetValueK S
<S T
stringT Z
>Z [
([ \
$str\ m
)m n
)n o
;o p
var 
quizHard 
= 
await  
_triviaDataService! 3
.3 4
GetDataAsync4 @
(@ A
_configA H
.H I
GetValueI Q
<Q R
stringR X
>X Y
(Y Z
$strZ i
)i j
)j k
;k l
await 
_triviaDataService $
.$ %
AddQuizRange% 1
(1 2
new2 5
List6 :
<: ;
QuizDto; B
>B C
{D E
quizEasyF N
,N O

quizMediumP Z
,Z [
quizHard\ d
}d e
)e f
;f g
await 
_userService 
. )
UpdateAllUsersHasDoneQuestion <
(< =
false= B
)B C
;C D
} 	
} 
}   õ]
NC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Services\QuizDataService.cs
	namespace 	
Quizle
 
. 
Core 
. 
Services 
{ 
public 

class 
QuizDataService  
:! "
IQuizDataService# 3
{ 
private 
readonly 
IRepository $
_repository% 0
;0 1
private 
readonly 
IMapper  
_mapper! (
;( )
public 
QuizDataService 
( 
IRepository *

repository+ 5
,5 6
IMapper7 >
mapper? E
)E F
{ 	
_repository 
= 

repository $
;$ %
_mapper 
= 
mapper 
; 
} 	
public 
async 
Task 
< 
QuizDto !
>! "
GetDataAsync# /
(/ 0
string0 6
url7 :
): ;
{ 	
var 
json 
= 
await 
new  
	WebClient! *
(* +
)+ ,
., -#
DownloadStringTaskAsync- D
(D E
urlE H
)H I
;I J
if   
(   
string   
.   
IsNullOrEmpty   $
(  $ %
json  % )
)  ) *
)  * +
{!! 
Console"" 
."" 
	WriteLine"" !
(""! "
$str""" 1
)""1 2
;""2 3
}## 
var$$ 
result$$ 
=$$ 
JsonConvert$$ $
.$$$ %
DeserializeObject$$% 6
<$$6 7
QuizResponseModel$$7 H
>$$H I
($$I J
json$$J N
)$$N O
?$$O P
.$$P Q
Results$$Q X
.$$X Y
First$$Y ^
($$^ _
)$$_ `
;$$` a
if%% 
(%% 
result%% 
==%% 
null%% 
)%% 
{&& 
return'' 
null'' 
;'' 
}(( 
var** 
answers** 
=** 
new** 
List** "
<**" #
	AnswerDto**# ,
>**, -
(**- .
)**. /
;**/ 0
foreach++ 
(++ 
var++ 
	incAnswer++ "
in++# %
result++& ,
.++, -
IncorrectAnswers++- =
)++= >
{,, 
answers-- 
.-- 
Add-- 
(-- 
new-- 
	AnswerDto--  )
(--) *
)--* +
{--, -
Answer--. 4
=--5 6
HttpUtility--7 B
.--B C

HtmlDecode--C M
(--M N
	incAnswer--N W
)--W X
,--X Y
	IsCorrect--Z c
=--d e
false--f k
}--l m
)--m n
;--n o
}.. 
answers// 
.// 
Add// 
(// 
new// 
	AnswerDto// %
(//% &
)//& '
{//( )
Answer//* 0
=//1 2
HttpUtility//3 >
.//> ?

HtmlDecode//? I
(//I J
result//J P
.//P Q
CorrectAnswer//Q ^
)//^ _
,//_ `
	IsCorrect//a j
=//k l
true//m q
}//r s
)//s t
;//t u
var00 
quiz00 
=00 
new00 
QuizDto00 "
(00" #
)00# $
{11 
Question22 
=22 
HttpUtility22 &
.22& '

HtmlDecode22' 1
(221 2
result222 8
.228 9
Question229 A
)22A B
,22B C

Difficulty33 
=33 
result33 #
.33# $

Difficulty33$ .
,33. /
Answers44 
=44 
answers44 !
,44! "
Category55 
=55 
result55 !
.55! "
Category55" *
,55* +
Type66 
=66 
result66 
.66 
Type66 "
}77 
;77 
return88 
quiz88 
;88 
}99 	
public;; 
async;; 
Task;; 
AddQuizRange;; &
(;;& '
IEnumerable;;' 2
<;;2 3
QuizDto;;3 :
>;;: ;
quizzes;;< C
);;C D
{<< 	
if== 
(== 
quizzes== 
==== 
null== 
)==  
{>> 
return?? 
;?? 
}@@ 
varAA 
quizzesDbosAA 
=AA 
newAA !
ListAA" &
<AA& '
QuizAA' +
>AA+ ,
(AA, -
)AA- .
;AA. /
foreachDD 
(DD 
varDD 
quizDD 
inDD  
quizzesDD! (
)DD( )
{EE 

DifficultyFF 

difficultyFF %
;FF% &
boolGG 
enumParseSuccessGG %
=GG& '
EnumGG( ,
.GG, -
TryParseGG- 5
(GG5 6
quizGG6 :
.GG: ;

DifficultyGG; E
,GGE F
outGGG J

difficultyGGK U
)GGU V
;GGV W
ifHH 
(HH 
!HH 
enumParseSuccessHH %
)HH% &
{II 
returnJJ 
;JJ 
}KK 
varLL 
quizDboLL 
=LL 
newLL !
QuizLL" &
(LL& '
)LL' (
{MM 
QuestionNN 
=NN 
quizNN #
.NN# $
QuestionNN$ ,
,NN, -
CategoryOO 
=OO 
quizOO #
.OO# $
CategoryOO$ ,
,OO, -
TypePP 
=PP 
quizPP 
.PP  
TypePP  $
,PP$ %

DifficultyQQ 
=QQ  

difficultyQQ! +
}RR 
;RR 
varSS 
answersSS 
=SS 
newSS !
ListSS" &
<SS& '
AnswerSS' -
>SS- .
(SS. /
)SS/ 0
;SS0 1
foreachTT 
(TT 
varTT 
answerTT #
inTT$ &
quizTT' +
.TT+ ,
AnswersTT, 3
)TT3 4
{UU 
varVV 
	answerDboVV !
=VV" #
newVV$ '
AnswerVV( .
(VV. /
)VV/ 0
{WW 
TextXX 
=XX 
answerXX %
.XX% &
AnswerXX& ,
,XX, -
	IsCorrectYY !
=YY" #
answerYY$ *
.YY* +
	IsCorrectYY+ 4
,YY4 5
QuizZZ 
=ZZ 
quizDboZZ &
}[[ 
;[[ 
answers\\ 
.\\ 
Add\\ 
(\\  
	answerDbo\\  )
)\\) *
;\\* +
}]] 
quizDbo^^ 
.^^ 
Answers^^ 
=^^  !
answers^^" )
;^^) *
quizzesDbos__ 
.__ 
Add__ 
(__  
quizDbo__  '
)__' (
;__( )
}`` 
awaitdd 
_repositorydd 
.dd 
AddRangeAsyncdd +
<dd+ ,
Quizdd, 0
>dd0 1
(dd1 2
quizzesDbosdd2 =
)dd= >
;dd> ?
awaitee 
_repositoryee 
.ee 
SaveChangesAsyncee .
(ee. /
)ee/ 0
;ee0 1
}gg 	
publichh 
asynchh 
Taskhh 
<hh 
QuizDtohh !
>hh! "
GetCurrentQuestionhh# 5
(hh5 6
inthh6 9
?hh9 :

difficultyhh; E
)hhE F
{ii 	
varjj 
countjj 
=jj 
_repositoryjj #
.jj# $
Countjj$ )
<jj) *
Quizjj* .
>jj. /
(jj/ 0
)jj0 1
;jj1 2
varkk 
quizDtokk 
=kk 
_repositorykk %
.ll 
Allll 
<ll 
Quizll 
>ll 
(ll 
)ll 
.mm 
Includemm 
(mm 
amm 
=>mm 
amm 
.mm  
Answersmm  '
)mm' (
.nn 
Wherenn 
(nn 
ann 
=>nn 
(nn 
intnn  
)nn  !
ann! "
.nn" #

Difficultynn# -
==nn. 0

difficultynn1 ;
)nn; <
.oo 
	ProjectTooo 
<oo 
QuizDtooo "
>oo" #
(oo# $
_mapperoo$ +
.oo+ ,!
ConfigurationProvideroo, A
)ooA B
.pp 
ToListpp 
(pp 
)pp 
.qq 
Lastqq 
(qq 
)qq 
;qq 
returnss 
quizDtoss 
;ss 
}tt 	
publicuu 
asyncuu 
Taskuu 
<uu 
Listuu 
<uu 
QuizDtouu &
>uu& '
>uu' ("
GetAllCurrentQuestionsuu) ?
(uu? @
)uu@ A
{vv 	
varww 
countww 
=ww 
_repositoryww #
.ww# $
Countww$ )
<ww) *
Quizww* .
>ww. /
(ww/ 0
)ww0 1
;ww1 2
varxx 
quizDtoxx 
=xx 
_repositoryxx %
.yy 
Allyy 
<yy 
Quizyy 
>yy 
(yy 
)yy 
.zz 
Includezz 
(zz 
azz 
=>zz 
azz 
.zz  
Answerszz  '
)zz' (
.{{ 
ToList{{ 
({{ 
){{ 
.|| 
OrderByDescending|| "
(||" #
a||# $
=>||% '
a||( )
.||) *
Id||* ,
)||, -
.}} 

DistinctBy}} 
(}} 
a}} 
=>}}  
a}}! "
.}}" #

Difficulty}}# -
)}}- .
.~~ 
Take~~ 
(~~ 
$num~~ 
)~~ 
. 
OrderBy 
( 
a 
=> 
a 
.  
Id  "
)" #
.
ÄÄ 
Select
ÄÄ 
(
ÄÄ 
a
ÄÄ 
=>
ÄÄ 
new
ÄÄ  
QuizDto
ÄÄ! (
(
ÄÄ( )
)
ÄÄ) *
{
ÅÅ 
Question
ÇÇ 
=
ÇÇ 
a
ÇÇ  
.
ÇÇ  !
Question
ÇÇ! )
,
ÇÇ) *
Category
ÉÉ 
=
ÉÉ 
a
ÉÉ  
.
ÉÉ  !
Category
ÉÉ! )
,
ÉÉ) *

Difficulty
ÑÑ 
=
ÑÑ  
a
ÑÑ! "
.
ÑÑ" #

Difficulty
ÑÑ# -
.
ÑÑ- .
ToString
ÑÑ. 6
(
ÑÑ6 7
)
ÑÑ7 8
,
ÑÑ8 9
Type
ÖÖ 
=
ÖÖ 
a
ÖÖ 
.
ÖÖ 
Type
ÖÖ !
,
ÖÖ! "
Answers
ÜÜ 
=
ÜÜ 
a
ÜÜ 
.
ÜÜ  
Answers
ÜÜ  '
.
ÜÜ' (
Select
ÜÜ( .
(
ÜÜ. /
a
ÜÜ/ 0
=>
ÜÜ1 3
new
ÜÜ4 7
	AnswerDto
ÜÜ8 A
(
ÜÜA B
)
ÜÜB C
{
áá 
Answer
àà 
=
àà  
a
àà! "
.
àà" #
Text
àà# '
,
àà' (
	IsCorrect
ââ !
=
ââ" #
a
ââ$ %
.
ââ% &
	IsCorrect
ââ& /
}
ää 
)
ää 
.
ää 
ToList
ää 
(
ää 
)
ää 
}
ãã 
)
ãã 
.
åå 
ToList
åå 
(
åå 
)
åå 
;
åå 
return
éé 
quizDto
éé 
;
éé 
}
èè 	
}
íí 
}ìì ©
JC:\DAVID\REPOS\Quizle\Quizle\Quizle.Core.Questions\Services\UserService.cs
	namespace 	
Quizle
 
. 
Core 
. 
Services 
{ 
public 

class 
UserService 
: 
IUserService +
{ 
private 
readonly 
IRepository $
_repository% 0
;0 1
public 
UserService 
( 
IRepository &

repository' 1
)1 2
{ 	
_repository 
= 

repository $
;$ %
} 	
public 
async 
Task )
UpdateAllUsersHasDoneQuestion 7
(7 8
bool8 <
valueToChangeTo= L
)L M
{ 	
var 
users 
= 
_repository #
.# $
All$ '
<' (
ApplicationUser( 7
>7 8
(8 9
)9 :
.: ;
ToList; A
(A B
)B C
;C D
foreach 
( 
var 
user 
in  
users! &
)& '
{ 
user 
. &
HasAnsweredCurrentQuestion /
=0 1
valueToChangeTo2 A
;A B
} 
_repository 
. 
UpdateRange #
(# $
users$ )
)) *
;* +
await 
_repository 
. 
SaveChangesAsync .
(. /
)/ 0
;0 1
} 	
public 
async 
Task )
UpdateAllUsersHasDoneQuestion 7
(7 8
bool8 <
valueToChangeTo= L
,L M

ExpressionN X
<X Y
FuncY ]
<] ^
ApplicationUser^ m
,m n
boolo s
>s t
>t u
usersToUpdate	v É
)
É Ñ
{   	
var!! 
users!! 
=!! 
_repository!! #
.!!# $
All!!$ '
<!!' (
ApplicationUser!!( 7
>!!7 8
(!!8 9
usersToUpdate!!9 F
)!!F G
.!!G H
ToList!!H N
(!!N O
)!!O P
;!!P Q
foreach"" 
("" 
var"" 
user"" 
in""  
users""! &
)""& '
{## 
user$$ 
.$$ &
HasAnsweredCurrentQuestion$$ /
=$$0 1
valueToChangeTo$$2 A
;$$A B
}%% 
_repository&& 
.&& 
UpdateRange&& #
(&&# $
users&&$ )
)&&) *
;&&* +
await'' 
_repository'' 
.'' 
SaveChangesAsync'' .
(''. /
)''/ 0
;''0 1
}(( 	
})) 
}** 